"""
設定ファイル - 音楽ジャンル分類プロジェクト
"""

# ==============================================================================
# 基本設定
# ==============================================================================
SEED = 42

# ==============================================================================
# 音声処理設定
# ==============================================================================
N_MELS = 128              # メルバンド数
SR = 22050                # サンプリングレート

# ==============================================================================
# モデル設定
# ==============================================================================
IMG_SIZE = 600            # EfficientNet の入力サイズ
NUM_CLASSES = 10          # 分類クラス数
NUM_CHANNELS = 4          # 入力チャンネル数（4stem: vocals / drums / bass / other）

# ==============================================================================
# 学習設定
# ==============================================================================
BATCH_SIZE = 24           # バッチサイズ（RTX3090 (24GB) なら16-24が可能。メモリ不足時は下げる）
EPOCHS = 50               # 最大エポック数
LR = 1e-4                 # 学習率（バッチサイズ増加に伴い学習率も調整）
# LR = 0.000154                 # 学習率（バッチサイズ増加に伴い学習率も調整）
WEIGHT_DECAY = 1e-4       # 重み減衰
TEST_SIZE = 0.1           # 検証データの割合

# ==============================================================================
# チェックポイント設定
# ==============================================================================
RESUME_FROM_CHECKPOINT = False      # チェックポイントから再開するか
LOAD_OPTIMIZER_STATE = False       # 最適化器の状態も読み込むか（新実装ではFalse推奨）
LOAD_SCHEDULER_STATE = False       # スケジューラの状態も読み込むか（新実装ではFalse推奨）

# ==============================================================================
# データオーギュメンテーション設定
# ==============================================================================
# 音声波形ベースのオーギュメンテーション
AUGMENT_PITCH_SHIFT = True         # ピッチシフトを適用するか
AUGMENT_TIME_STRETCH = True        # タイムストレッチを適用するか
AUGMENT_ADD_NOISE = True          # ノイズを追加するか
AUGMENT_TIME_SHIFT = True         # タイムシフトを適用するか

# ピッチシフトの範囲（半音）
PITCH_SHIFT_MIN = -2
PITCH_SHIFT_MAX = 2

# タイムストレッチの範囲
TIME_STRETCH_MIN = 0.8
TIME_STRETCH_MAX = 1.2

# ノイズの範囲
NOISE_FACTOR_MIN = 0.001
NOISE_FACTOR_MAX = 0.01

# タイムシフトの最大値（秒）
TIME_SHIFT_MAX_SEC = 0.2

# SpecAugment（メルスペクトログラムベース）
AUGMENT_TIME_MASKING = True       # Time Maskingを適用するか
AUGMENT_FREQUENCY_MASKING = True  # Frequency Maskingを適用するか

# ボーカル抜きオーギュメンテーション（積分値で低ボーカルを疑似的に増やす）
VOCAL_INTEGRAL_THRESHOLD = 2500   # この値以下を「低ボーカル」とみなす
VOCAL_DROP_TARGET_RATIO = 0.5     # ジャンルごとに低ボーカルを何割にしたいか（5:5 なら 0.5）
AUGMENT_VOCAL_DROP = True         # ボーカル抜きオーギュメンテーションを有効にするか

# ==============================================================================
# 音源分離設定（Demucs）
# ==============================================================================
SEPARATION_MODEL = 'htdemucs'         # Demucsモデル名（htdemucs, htdemucs_ft, mdx_extra等）
SEPARATION_CACHE_DIR = 'data/separated'  # 分離結果のキャッシュディレクトリ

# ==============================================================================
# ファイルパス設定
# ==============================================================================
CHECKPOINT_FILE = 'checkpoint.pth'
BEST_MODEL_FILE = 'best_model.pth'
SUBMIT_FILE = 'submit.csv'
LOG_FILE = 'train_log.txt'          # 学習ログの出力先

# ==============================================================================
# Mixed Precision
# ==============================================================================
USE_AMP = True                # Mixed Precision Training（VRAM約40-50%削減）

# ==============================================================================
# Early Stopping設定
# ==============================================================================
PATIENCE = 20             # Early Stoppingのpatience
